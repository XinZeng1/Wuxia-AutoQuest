# Design: 改进战斗状态检测

## Context
当前战斗状态检测使用模板匹配方法，需要准备战斗界面模板文件。用户反馈战斗时屏幕右边有"认输"两个字，可以使用OCR识别这个文本来更准确地检测战斗状态。

## Goals / Non-Goals

### Goals
- 使用OCR识别"认输"文字来检测战斗状态
- 优化点击怪物后的等待时间
- 改进战斗检测频率（每秒检测）
- 战斗结束后自动重新检测怪物

### Non-Goals
- 不实现战斗操作（战斗自动进行）
- 不实现战斗结果分析（只检测状态）

## Decisions

### Decision: 使用OCR识别"认输"文字
**原因**: 
- 更灵活，不需要准备模板文件
- 文字识别比图像匹配更准确
- 可以配置检测区域（屏幕右边）

**替代方案**: 
- 模板匹配：需要准备模板，不够灵活
- 多种方法组合：可以同时支持OCR和模板匹配

### Decision: 支持多种检测方法
**原因**:
- 提供OCR和模板匹配两种方法
- 用户可以根据需要选择
- 提高兼容性和鲁棒性

**替代方案**:
- 只使用OCR：可能在某些情况下识别失败
- 只使用模板匹配：不够灵活

### Decision: 每秒检测战斗状态
**原因**:
- 平衡检测准确性和性能
- 1秒间隔足够检测状态变化
- 避免过于频繁的检测影响性能

**替代方案**:
- 更频繁检测（0.5秒）：可能影响性能
- 更慢检测（2秒）：可能错过状态变化

## Risks / Trade-offs

### Risk: OCR识别失败
**缓解措施**: 
- 支持模板匹配作为备选
- 可以配置检测区域提高准确率
- 提供诊断工具帮助调试

### Risk: 等待时间不合适
**缓解措施**: 
- 可配置的等待时间
- 根据实际情况调整

### Trade-off: 检测频率 vs 性能
- 更频繁检测 = 更准确但更耗资源
- 方案：每秒检测一次，平衡准确性和性能

## Open Questions
1. "认输"文字的具体位置是否需要配置？
2. 是否需要支持其他战斗状态指示文字？
