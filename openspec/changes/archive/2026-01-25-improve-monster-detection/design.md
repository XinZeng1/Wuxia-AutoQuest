# Design: 改进怪物检测识别能力

## Context
当前怪物检测使用单一的模板匹配方法（TM_CCOEFF_NORMED），可能因为以下原因导致识别失败：
- 模板图像与实际游戏中的怪物图标不完全匹配
- 阈值设置不当（过高或过低）
- 图像质量差异（光照、对比度、缩放）
- 匹配方法不适合当前场景
- 需要图像预处理来提高匹配率

## Goals / Non-Goals

### Goals
- 诊断当前检测失败的根本原因
- 提供多种检测方法以提高识别率
- 支持图像预处理以提高匹配准确率
- 提供详细的诊断工具帮助调试
- 实现自适应机制以应对不同场景

### Non-Goals
- 不实现深度学习检测（保持简单方案）
- 不实现复杂的特征匹配（保持模板匹配方案）
- 不实现实时学习（保持静态模板方案）

## Decisions

### Decision: 实现多种OpenCV匹配方法
**原因**: 
- 不同匹配方法对不同场景的适应性不同
- TM_CCOEFF_NORMED可能不适合当前场景
- 可以尝试多种方法并选择最佳结果

**替代方案**: 
- 单一方法优化：可能无法解决根本问题
- 深度学习：开发周期长，需要训练数据

### Decision: 添加图像预处理选项
**原因**:
- 原始图像可能存在光照、对比度问题
- 预处理可以提高模板匹配的鲁棒性
- 可以尝试多种预处理组合

**替代方案**:
- 不预处理：可能无法解决图像质量问题
- 复杂预处理：可能过度处理，影响性能

### Decision: 实现多模板支持
**原因**:
- 不同怪物可能有不同的外观
- 单个模板可能无法覆盖所有情况
- 可以设置模板优先级

**替代方案**:
- 单一模板：可能无法识别所有怪物类型
- 动态模板生成：复杂度高

### Decision: 实现自适应阈值
**原因**:
- 固定阈值可能不适合所有场景
- 可以根据图像质量动态调整
- 提高检测的鲁棒性

**替代方案**:
- 固定阈值：需要手动调整，不够灵活
- 机器学习阈值：复杂度高

## Risks / Trade-offs

### Risk: 多种方法导致性能下降
**缓解措施**: 
- 可以配置使用的方法
- 按优先级尝试，找到匹配即停止
- 缓存预处理结果

### Risk: 预处理可能降低准确率
**缓解措施**: 
- 提供配置选项，可以选择是否预处理
- 测试不同预处理组合的效果
- 保留原始匹配方法作为备选

### Trade-off: 准确率 vs 性能
- 更多方法 = 更高准确率但更慢
- 方案：提供配置选项，用户可以根据需要选择

## Open Questions
1. 是否需要支持模板缩放匹配（处理不同尺寸的怪物）？
2. 是否需要支持旋转匹配（处理旋转的怪物图标）？
3. 诊断工具应该提供哪些信息？
