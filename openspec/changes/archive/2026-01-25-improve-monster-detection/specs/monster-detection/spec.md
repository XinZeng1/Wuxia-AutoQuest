## MODIFIED Requirements
### Requirement: 怪物图标识别能力
系统 SHALL 能够识别地图上出现的怪物图标，区分不同类型的敌人。系统 SHALL 支持多种图像匹配方法和预处理选项以提高识别准确率。

#### Scenario: 识别单个怪物（多方法）
- **WHEN** 分析地图界面
- **AND** 使用多种匹配方法检测
- **THEN** 识别并返回地图上所有怪物的位置和类型
- **AND** 选择置信度最高的匹配结果

#### Scenario: 识别多个怪物（多模板）
- **WHEN** 分析地图界面
- **AND** 配置了多个怪物模板
- **AND** 地图上存在多个不同类型的怪物
- **THEN** 返回所有怪物的位置和类型列表
- **AND** 每个怪物都标注了匹配的模板

#### Scenario: 自适应阈值匹配
- **WHEN** 检测怪物时
- **AND** 固定阈值无法匹配
- **THEN** 系统自动尝试降低阈值
- **AND** 返回匹配结果和实际使用的阈值

## ADDED Requirements
### Requirement: 多匹配方法支持
系统 SHALL 支持多种OpenCV模板匹配方法，并能够自动选择或组合使用。

#### Scenario: 尝试多种匹配方法
- **WHEN** 检测怪物时
- **AND** 配置了多种匹配方法
- **THEN** 依次尝试每种方法
- **AND** 返回最佳匹配结果

#### Scenario: 匹配方法配置
- **WHEN** 用户配置匹配方法
- **THEN** 系统使用指定的方法进行检测
- **AND** 可以配置多种方法的优先级顺序

### Requirement: 图像预处理支持
系统 SHALL 支持对模板和截图进行预处理以提高匹配准确率。

#### Scenario: 应用图像预处理
- **WHEN** 检测怪物时
- **AND** 启用了预处理选项
- **THEN** 对模板和截图应用预处理
- **AND** 使用预处理后的图像进行匹配

#### Scenario: 预处理选项配置
- **WHEN** 用户配置预处理选项
- **THEN** 系统应用指定的预处理步骤
- **AND** 可以配置多种预处理组合

### Requirement: 多模板支持
系统 SHALL 支持使用多个怪物模板进行检测。

#### Scenario: 使用多个模板检测
- **WHEN** 配置了多个怪物模板
- **THEN** 使用所有模板进行检测
- **AND** 合并所有模板的检测结果

#### Scenario: 模板优先级
- **WHEN** 多个模板都匹配到同一位置
- **THEN** 选择优先级最高的模板结果
- **AND** 返回匹配的模板信息

### Requirement: 自适应阈值机制
系统 SHALL 能够根据图像质量动态调整匹配阈值。

#### Scenario: 自动降低阈值
- **WHEN** 使用默认阈值无法匹配
- **AND** 最高置信度接近阈值
- **THEN** 自动降低阈值重试
- **AND** 返回匹配结果

#### Scenario: 阈值范围配置
- **WHEN** 用户配置阈值范围
- **THEN** 系统在范围内尝试不同阈值
- **AND** 选择最佳匹配结果

### Requirement: 检测诊断能力
系统 SHALL 提供详细的检测诊断信息，帮助分析检测失败原因。

#### Scenario: 生成检测报告
- **WHEN** 检测怪物时
- **AND** 启用了诊断模式
- **THEN** 生成详细的检测报告
- **AND** 包含所有匹配尝试的结果和置信度

#### Scenario: 可视化匹配结果
- **WHEN** 检测怪物时
- **AND** 启用了可视化选项
- **THEN** 在截图上标记所有可能的匹配位置
- **AND** 保存标记后的图像用于分析
