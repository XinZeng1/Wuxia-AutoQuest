# 游戏自动刷图配置文件

# 屏幕镜像窗口配置
window:
  # 窗口左上角坐标和宽高
  x: 100
  y: 400
  width: 674
  height: 316
  # 或者使用相对坐标（相对于屏幕）
  # relative: true

# 截图配置
screenshot:
  # 是否使用 Mac Retina 截图（需要安装 pyobjc-framework-Quartz）
  # Retina 截图更清晰，但需要 Mac 系统和 pyobjc
  use_retina: true

# 游戏配置
game:
  # 探索度目标（百分比）
  exploration_target: 100
  # 战斗等待超时时间（秒）
  battle_timeout: 300
  # 移动点击延迟（秒）
  move_click_delay: 0.5
  # 点击怪物后等待时间（秒，让角色走向怪物）
  post_click_wait: 1.0

# 识别配置
recognition:
  # 模板匹配置信度阈值（0-1）
  # 如果误报太多，提高到0.85或更高
  # 如果检测不到，降低到0.4或更低
  template_match_threshold: 0.85
  # 最大匹配数量（防止误报过多）
  max_matches: 5
  # NMS重叠阈值（0-1，越小越严格）
  nms_overlap_threshold: 0.2
  # 匹配方法列表（按优先级排序）
  match_methods:
    - "TM_CCORR_NORMED"  # 根据诊断工具推荐使用
    - "TM_CCOEFF_NORMED"
    - "TM_SQDIFF_NORMED"
  # 图像预处理选项
  preprocess:
    enabled: false  # 是否启用预处理
    enhance_contrast: false  # 增强对比度
    edge_detection: false  # 边缘检测
    binarize: false  # 二值化
  # OCR配置
  ocr:
    engine: "easyocr"  # "pytesseract" 或 "easyocr" (推荐easyocr，对中文识别更好)
    lang: "chi_sim"  # 中文简体（仅用于pytesseract）

# 怪物检测配置
monster:
  # 检测方法: 'name' (基于OCR识别名称) 或 'template' (基于模板匹配)
  detection_method: "name"
  # OCR预处理模式: 'none' (不预处理), 'light' (轻量), 'medium' (中等), 'heavy' (重度)
  # 如果图像模糊，尝试 'none' 或 'light'
  ocr_preprocess_mode: "light"
  # 怪物名称关键词列表（用于OCR匹配，如果文本包含这些关键词则认为是怪物名称）
  name_keywords:
    - "豫州劫匪"
    - "逆徒"
    - "云海派"
    - "逃徒"
    - "逃犯"
    - "强盗"
  # 怪物模板列表（按优先级排序，用于template方法）
  templates:
    - "monster.png"

# 战斗检测配置
combat:
  # 检测方法: 'ocr' (OCR识别"认输"文字), 'template' (模板匹配), 'both' (两种方法都尝试)
  detection_method: "ocr"
  # 检查间隔（秒），战斗中进行状态检测的频率
  check_interval: 1.0
  # 战斗检测区域（坐标相对于游戏窗口，不是屏幕坐标）
  # 可以使用 tools/test_combat_config.py 工具验证配置是否正确
  detection_region:
    left: 600   # 文本区域左边界（相对于窗口，默认屏幕右边75%位置）
    top: 40    # 文本区域上边界（相对于窗口，默认屏幕35%位置）
    width: 60  # 文本区域宽度（默认窗口宽度20%）
    height: 20  # 文本区域高度（默认窗口高度30%）
  # OCR识别关键词列表（如果识别到这些文字则认为在战斗中）
  keywords:
    - "认输"
    - "讥输"
    - "输"

# 小地图与边界巡航（基于边界巡航与坐标栈回溯）
minimap:
  region:
    left: 565
    top: 0
    width: 115
    height: 115
  boundary:
    yellow_lower: [20, 100, 100]
    yellow_upper: [35, 255, 255]
  # 忽略距中心过近的黄点（小地图像素），避免误用玩家/噪声导致 D_mm=1~2、乱点
  min_yellow_dist_px: 5
  # 方向偏好：auto（自动，根据黄点分布）、t1（固定 t1）、t2（固定 t2）。闭环地图建议用 t1 或 t2
  prefer_direction: auto
  # 连续 N 步同向后锁定方向，避免闭环地图时左右切换（0=禁用锁定，建议2）
  direction_lock_steps: 2
  # 固定步长时用（未配置 minimap_to_game_ratio 时）
  move_scale: 50
  # 小地图距离→游戏内步长比例：1 小地图像素 = N 游戏像素。用 tools/calibrate_minimap_ratio.py 测算
  minimap_to_game_ratio: 25
  # 当 D_mm < 此值时使用固定 move_scale（0=始终用比例，步长=ratio*max(D_mm,1)）
  min_distance_for_ratio: 0
  # 当 D_mm 很小时（贴近边界），限制最大步长，避免点到墙里面（0=自动用 move_scale*0.8，约40px）
  close_boundary_max_step: 50
  # 贴近判定的 D_mm 阈值；未设则用 min_yellow_dist_px*2。D_mm 低于此值才限制步长
  # close_boundary_d_mm_threshold: 20
  move_scale_min: 15
  move_scale_max: 120
  cruise_interval_sec: 1.2
  # 分象限覆盖：upper=左上+右上（与墙保持距离），lower=左下+右下（可贴墙）
  # close_boundary_d_mm_threshold: 当 D_mm 小于此值时限制步长，避免贴墙时步长过大点到墙外（未设则用 min_yellow_dist_px*2）
  quadrants:
    upper:
      close_boundary_max_step: 35
      close_boundary_d_mm_threshold: 18
      min_yellow_dist_px: 8
    lower:
      close_boundary_max_step: 40
      close_boundary_d_mm_threshold: 20
      min_yellow_dist_px: 5

# 回溯与防卡死
backtrack:
  tolerance_px: 40
  stuck_timeout_sec: 2.0
  stuck_same_tolerance_px: 4
  escape_radius_px: 80
  arrive_wait_sec: 1.0
  # 卡死检测：角色始终在屏中央，不用「点击同点」判断。改用小地图是否变化。
  minimap_stuck_enabled: true
  minimap_stuck_diff_threshold: 0.02   # 连续帧指纹平均差异低于此视为未移动

# 探索度配置
exploration:
  # 探索度文本区域（可以使用 tools/locate_exploration_text.py 工具定位）
  text_region:
    left: 50    # 文本区域左边界（相对于窗口）
    top: 35     # 文本区域上边界（相对于窗口）
    width: 75  # 文本区域宽度
    height: 15  # 文本区域高度

# 日志配置
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "logs/auto_farming.log"
  console: true
